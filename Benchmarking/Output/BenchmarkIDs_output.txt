
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ################################################################################
> #                     TO RUN THE ENTIRE PHOSFAKE PIPELINE                      #
> ################################################################################
> 
> #####################
> ## Set path:
> #####################
> 
> # wd <- getwd()
> wd <- "/home/projects/jensenlab/people/malopa/PhosFake/BenchmarkingNoMod"
> pathToRes <- paste0(wd, "/Output/BenchmarkIDs")
> pathToFasta <- paste0(wd, "/input_fasta")
> pathToFasta <- list.files(path = pathToFasta, full.names = T, pattern = ".fasta")
> pathToFunctions <- paste0(wd, "/Functions")
> if (!dir.exists(pathToRes)) {
+   cat("Create result directory:", pathToRes)
+   dir.create(pathToRes)
+ }
Create result directory: /home/projects/jensenlab/people/malopa/PhosFake/BenchmarkingNoMod/Output/BenchmarkIDs> #####################
> 
> #####################
> ## Load results
> #####################
> sapply(list.files(pathToFunctions, full.names = T), source)
Loading required package: grid
        /home/projects/jensenlab/people/malopa/PhosFake/BenchmarkingNoMod/Functions/01_GenerateGroundTruth.R
value   ?                                                                                                   
visible FALSE                                                                                               
        /home/projects/jensenlab/people/malopa/PhosFake/BenchmarkingNoMod/Functions/02_Digestion.R
value   ?                                                                                         
visible FALSE                                                                                     
        /home/projects/jensenlab/people/malopa/PhosFake/BenchmarkingNoMod/Functions/Parameter.R
value   0                                                                                      
visible FALSE                                                                                  
> # Parameters to test:
> paramToTest <- list("PathToFasta" = pathToFasta, 
+                     "PropMissedCleavages" = seq(from = 0, to = 1, by = 0.2), 
+                     "MaxNumMissedCleavages" = 0:4,
+                     "PepMinLength" = seq(from = 4, to = 12, by = 1),
+                     "PepMaxLength" = seq(from = 16, to = 35, by = 1))
> #####################
> 
> #####################
> ## Run the sample preparation simulation:
> #####################
> # Create the initial list of proteoforms for each fasta file tested:
> lp <- vector(mode = "list")
> for (i in 1:length(paramToTest$PathToFasta)) {
+   Param$PathToFasta <- paramToTest$PathToFasta[i]
+   lp[[i]] <- samplePreparation(parameters = Param)
+   fasname <- gsub(getwd(), "", paramToTest$PathToFasta[i])
+   fasname <- gsub(".fasta", "", fasname)
+   names(lp)[i] <- gsub("^.+/", "", fasname)
+   rm(fasname)
+ }
+ Importing data:
 - File /home/projects/jensenlab/people/malopa/PhosFake/BenchmarkingNoMod/input_fasta/uniprot-proteome%3AUP000000589_20200210.fasta imported, containing 55408 protein sequences.
 - A total of 4371 protein sequences have been removed due to unusual amino acids (B,J,O,U,X,Z) composition.
 - A total of 0 duplicated protein accessions have been removed.
 - Total number of remaining protein sequences: 51037 

+ Creating modified and unmodified fractions:
 - A total of 3715 sequences are unmodifiable.
 - The protein set cannot be fractionated, too low number of proteins or too low FracModProt %.
 - Modified fraction: 0 proteins.
 - Unmodified fraction: 51037 proteins.

No modified proteins in these data
+ Importing data:
 - File /home/projects/jensenlab/people/malopa/PhosFake/BenchmarkingNoMod/input_fasta/uniprot-proteome%3AUP000002311_20200210.fasta imported, containing 6049 protein sequences.
 - A total of 0 protein sequences have been removed due to unusual amino acids (B,J,O,U,X,Z) composition.
 - A total of 0 duplicated protein accessions have been removed.
 - Total number of remaining protein sequences: 6049 

+ Creating modified and unmodified fractions:
 - A total of 95 sequences are unmodifiable.
 - The protein set cannot be fractionated, too low number of proteins or too low FracModProt %.
 - Modified fraction: 0 proteins.
 - Unmodified fraction: 6049 proteins.

No modified proteins in these data
+ Importing data:
 - File /home/projects/jensenlab/people/malopa/PhosFake/BenchmarkingNoMod/input_fasta/uniprot-proteome%3AUP000005640_20200210.fasta imported, containing 74788 protein sequences.
 - A total of 8190 protein sequences have been removed due to unusual amino acids (B,J,O,U,X,Z) composition.
 - A total of 0 duplicated protein accessions have been removed.
 - Total number of remaining protein sequences: 66598 

+ Creating modified and unmodified fractions:
 - A total of 6801 sequences are unmodifiable.
 - The protein set cannot be fractionated, too low number of proteins or too low FracModProt %.
 - Modified fraction: 0 proteins.
 - Unmodified fraction: 66598 proteins.

No modified proteins in these data
> 
> GroundTruth <- lapply(lp, addProteoformAbundance, parameters = Param)
Add quan. distribution: Relative -> absolute
Add quan. distribution: Relative -> absolute
Add quan. distribution: Relative -> absolute
> 
> paramToTest <- paramToTest[-1]
> #####################
> 
> #####################
> ## Digestion and sample peptide enrichment:
> #####################
> library(purrr)

Attaching package: 'purrr'

The following object is masked _by_ '.GlobalEnv':

    modify

> listtotest <- cross(paramToTest)
> cat("Start generation of", length(listtotest), "parameter sets for digestion\n")
Start generation of 5400 parameter sets for digestion
> # Digest all the proteoforms and get peptide table:
> iter <- 1
> for (i in seq_along(GroundTruth)) {
+   f <- GroundTruth[[i]]
+   for (x in listtotest) {
+     d <- DigestGroundTruth(GroundTruth = f, parameters = c(Param[!(names(Param) %in% names(x))], x))
+     upep <- names(table(d$PepSequence))[table(d$PepSequence) == 1]
+     utab <- d[d$PepSequence %in% upep,]
+     output <- list("Fasta" = names(GroundTruth)[i],
+                    "Param" = x, 
+                    "NumUniquePep" = length(unique(d$PepSequence)), 
+                    "NumPepOneAcc" = length(upep), 
+                    "NumAccPerMinPepNum" = table(table(utab$Accession)))
+     save(output,
+          file = paste0(pathToRes, "/output", iter, ".RData"))
+     cat("Save output", iter, "over", length(listtotest))
+     iter <- iter + 1
+   }
+ }
Start digestion
Start row-bind
Start filtering
Save output 1 over 5400Start digestion
Start row-bind
Start filtering
Save output 2 over 5400Start digestion
Start row-bind
Start filtering
Save output 3 over 5400Start digestion
Start row-bind
Start filtering
Save output 4 over 5400Start digestion
Start row-bind
Start filtering
Save output 5 over 5400Start digestion
Start row-bind
Start filtering
Save output 6 over 5400Start digestion
Start generation of missed-cleavages
Number =  0 
Row-bind missed cleavages
Table done
Start filtering
Save output 7 over 5400Start digestion
Start generation of missed-cleavages
Number =  483665 
